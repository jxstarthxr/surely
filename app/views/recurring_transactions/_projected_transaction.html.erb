<%# locals: (recurring_transaction:) %>

<div class="grid grid-cols-12 items-center text-subdued text-sm font-medium p-4 lg:p-4 bg-container-inset rounded">
  <div class="pr-4 lg:pr-10 flex items-center gap-3 lg:gap-4 col-span-8">
    <div class="max-w-full">
      <%= content_tag :div, class: ["flex items-center gap-2"] do %>
        <% if recurring_transaction.merchant.present? %>
          <% if recurring_transaction.merchant.logo_url.present? %>
            <div data-controller="adaptive-logo" class="w-10 h-10 rounded-[22%] overflow-hidden flex items-center justify-center border-2 border-gray-200 p-1" data-adaptive-logo-target="container">
              <%= image_tag recurring_transaction.merchant.logo_url,
                  class: "w-full h-full object-contain rounded-[18%]",
                  loading: "lazy",
                  data: { adaptive_logo_target: "image" } %>
            </div>
          <% else %>
            <%= render DS::FilledIcon.new(
              variant: :text,
              text: recurring_transaction.merchant.name,
              size: "sm",
              rounded: false
            ) %>
          <% end %>
        <% else %>
          <%= render DS::FilledIcon.new(
            variant: :text,
            text: recurring_transaction.name,
            size: "sm",
            rounded: false
          ) %>
        <% end %>

        <div class="truncate">
          <div class="space-y-0.5">
            <div class="flex items-center gap-2 min-w-0">
              <div class="truncate flex-shrink">
                <%= recurring_transaction.merchant.present? ? recurring_transaction.merchant.name : recurring_transaction.name %>
              </div>

              <div class="flex items-center gap-1 flex-shrink-0">
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-tint-10 text-link">
                  <%= t("recurring_transactions.projected") %>
                </span>
              </div>
            </div>

            <div class="text-secondary text-xs font-normal">
              <%= t("recurring_transactions.expected_on", date: l(recurring_transaction.next_expected_date, format: :short)) %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <div class="hidden lg:flex items-center gap-1 col-span-2">
    <span class="text-xs text-secondary"><%= t("recurring_transactions.recurring") %></span>
  </div>

  <div class="col-span-2 ml-auto text-right">
    <% display_amount = recurring_transaction.manual? && recurring_transaction.expected_amount_avg.present? ? recurring_transaction.expected_amount_avg : recurring_transaction.amount %>
    <%= content_tag :p, format_money(-Money.new(display_amount, recurring_transaction.currency)), class: ["font-medium", display_amount.negative? ? "text-success" : "text-subdued"] %>
  </div>
</div>
